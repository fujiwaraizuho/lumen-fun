box: dala00/laravel
services:
  - id: mysql
    tag: 5.7
    env:
      MYSQL_ALLOW_EMPTY_PASSWORD: true
      MYSQL_DATABASE: lumen_fun_test
      
build:
  steps:
    - script:
        name: Install dependencies
        code: |
          composer install

    - script:
        name: Fill mysql env.
        code: |-
          sudo cp .env.example .env
          sudo cat .env | sudo sed -i -e "s/DB_USERNAME=homestead/DB_USERNAME=root/g"
          sudo cat .env | sudo tr -d DB_PASSWORD=secret
          
    - script:
        name: Run phpunit
        code: |-
          vendor/bin/phpunit
